<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Rabbee"><meta name=description content="兔子的咖啡馆"><meta name=keywords content="兔子的咖啡馆"><link rel=prev href=/2017/05/18/archlinux%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/><link rel=next href=/2020/01/13/%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/><link rel=canonical href=/2017/06/07/%E5%B9%BF%E5%B7%A5%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%8A%A9%E6%89%8B%E7%AC%94%E8%AE%B0/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>广工教务系统助手 | 兔子的咖啡馆</title><meta name=title content="广工教务系统助手 | 兔子的咖啡馆"><link rel=stylesheet href=/font/iconfont.css><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":""},"articleSection":"posts","name":"广工教务系统助手","headline":"广工教务系统助手","description":"在我们学校的教务系统里，如果你想查成绩，那得先把这学期的老师都评价完。在旧版教务系统中，教师评价一直是一个很烦人的东西：一个教师就要填10个左右的问题，而且同一个教师可能出现多次（课程和实验分开）。那个时候有一个APP叫做“广工校园通”，应该是出自某个工作室之手。但今年寒假我开始发现它不能用了，不知道是因为教务系统改版，他们没有精力做，还是据说这个APP是当时他们参加比赛做的，比完就没人维护了。于是寒假前一段时间我花了点时间抓新教务系统的包，把教师评价做了出来。当时只支持对所有教师评价，无论之前有没有评价过。这里要吐槽一点：后来评价的内容将覆盖之前评价的内容。这阵子突发奇想：不如把这个功能弄进小程序吧，反正正好体验下这么久以来都没碰过的小程序。于是乎就有了这篇东西～\n抓包 工具选择  这里我用的是Firefox的拓展：HttpFox  开始捉包吧 登录  打开非常炫酷的教务系统登录界面   打开httpfox的窗口，点击开始。  然后教务系统输入账号密码登录吧～登录进去后把HttpFox暂停了，以免一直通讯的包都捉进来，我们现在要的是登录的包。\n 就下来我们看到如下的登录包   恩，这就是我们要的东西。之后要什么东西，拿着下面这个Cookies就有了通行证啦～  微信小程序 注册完小程序后，我直接跳过了官网文档的设计部分，毕竟先实现功能嘛，界面什么的后面再改。开发过程中遇到了一些坑，下面来说下这些坑。\n1. 请求必须是Https 仔细看看国内的很多网站，其实都没有使用https。这里不能怪教务系统吧不使用https，毕竟用了的话我们也不好通过捉包来干这事。所以才有了后文的后台程序，提供一个https转发请求的功能。也就是使用自己的服务器来接收小程序的https请求，再用http请求与教务系统通讯。 2. 设置页面的后台数据 setData 这里想用setData({})修改后台数据中某个数组中的值。于是乎有了下面的代码。\nPage({ data: { strs: [ \x26#39;abc\x26#39;, \x26#39;def\x26#39;, \x26#39;ghj\x26#39;, \x26#39;klm\x26#39; ], temp: \x26#39;\x26#39; }, \/\/事件处理函数  ... changeStrs: function(e){ var index = e.currentTarget.id; this.data.strs[index] = str; this.setData({ strs: this.data.strs }); } }) 后台 其实我也不会什么后台，PHP、NodeJs、Javaweb、Asp.net之流什么的也没玩过。只是因为最近\x26quot;Py交易\x26quot;多，所以才用了Python里的Flask框架。这里就没什么技术问题了。都是很简单的请求。这里贴上些简单的代码。\n登录请求  登录  @app.route(\x26#39;\/api\/gdut\/login\x26#39;, methods=[\x26#39;GET\x26#39;, \x26#39;POST\x26#39;]) def login(): if request.","inLanguage":"zh-cn","author":"Rabbee","creator":"Rabbee","publisher":"Rabbee","accountablePerson":"Rabbee","copyrightHolder":"Rabbee","copyrightYear":"2017","datePublished":"2017-06-07 10:31:14 \x2b0000 UTC","dateModified":"2017-06-07 10:31:14 \x2b0000 UTC","url":"\/2017\/06\/07\/%E5%B9%BF%E5%B7%A5%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%8A%A9%E6%89%8B%E7%AC%94%E8%AE%B0\/","wordCount":"113","keywords":["微信小程序","Javascript","Python","兔子的咖啡馆"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href>兔子的咖啡馆</a></div><div class="menu navbar-right"><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>目录</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/about/>关于</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href>兔子的咖啡馆</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=/posts/>文章</a>
<a class=menu-item href=/categories/>目录</a>
<a class=menu-item href=/tags/>标签</a>
<a class=menu-item href=/about/>关于</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">广工教务系统助手</h1><div class=post-meta>Written by <a itemprop=name href rel=author>Rabbee</a> with ♥
<span class=post-time>on <time datetime=2017-06-07 itemprop=datePublished>June 7, 2017</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=/categories/%E7%AC%94%E8%AE%B0/>笔记</a></span></div></header><div class=post-content><p>在我们学校的教务系统里，如果你想查成绩，那得先把这学期的老师都评价完。在旧版教务系统中，教师评价一直是一个很烦人的东西：一个教师就要填10个左右的问题，而且同一个教师可能出现多次（课程和实验分开）。那个时候有一个APP叫做“广工校园通”，应该是出自某个工作室之手。但今年寒假我开始发现它不能用了，不知道是因为教务系统改版，他们没有精力做，还是据说这个APP是当时他们参加比赛做的，比完就没人维护了。于是寒假前一段时间我花了点时间抓新教务系统的包，把教师评价做了出来。当时只支持对所有教师评价，无论之前有没有评价过。这里要吐槽一点：后来评价的内容将覆盖之前评价的内容。这阵子突发奇想：不如把这个功能弄进小程序吧，反正正好体验下这么久以来都没碰过的小程序。于是乎就有了这篇东西～</p><p><img src=/images/gdut-senate-manager-system/index.png alt=img></p><h2 id=heading>抓包</h2><h3 id=heading-1>工具选择</h3><ul><li>这里我用的是Firefox的拓展：<a href=https://addons.mozilla.org/en-US/firefox/addon/httpfox/developers>HttpFox</a></li></ul><p><img src=/images/gdut-senate-manager-system/httpfox.png alt=img></p><h3 id=heading-2>开始捉包吧</h3><h4 id=heading-3>登录</h4><ul><li>打开非常炫酷的教务系统登录界面</li></ul><p><img src=/images/gdut-senate-manager-system/login.png alt=img></p><ul><li>打开httpfox的窗口，点击开始。</li></ul><p>然后教务系统输入账号密码登录吧～登录进去后把HttpFox暂停了，以免一直通讯的包都捉进来，我们现在要的是登录的包。</p><ul><li>就下来我们看到如下的登录包</li></ul><p><img src=/images/gdut-senate-manager-system/login-pkg.png alt=img></p><ul><li>恩，这就是我们要的东西。之后要什么东西，拿着下面这个Cookies就有了通行证啦～</li></ul><p><img src=/images/gdut-senate-manager-system/login-cookies.png alt=img></p><h2 id=heading-4>微信小程序</h2><p>注册完小程序后，我直接跳过了官网文档的设计部分，毕竟先实现功能嘛，界面什么的后面再改。开发过程中遇到了一些坑，下面来说下这些坑。</p><h3 id=1-https>1. 请求必须是Https</h3><p>仔细看看国内的很多网站，其实都没有使用https。这里不能怪教务系统吧不使用https，毕竟用了的话我们也不好通过捉包来干这事。所以才有了后文的后台程序，提供一个https转发请求的功能。也就是使用自己的服务器来接收小程序的https请求，再用http请求与教务系统通讯。
<img src=/images/gdut-senate-manager-system/request.png alt=img></p><h3 id=2--setdata>2. 设置页面的后台数据 setData</h3><p>这里想用setData({})修改后台数据中某个数组中的值。于是乎有了下面的代码。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a6e22e>Page</span>({
  <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
    <span style=color:#a6e22e>strs</span><span style=color:#f92672>:</span> [
      <span style=color:#e6db74>&#39;abc&#39;</span>,
      <span style=color:#e6db74>&#39;def&#39;</span>,
      <span style=color:#e6db74>&#39;ghj&#39;</span>,
      <span style=color:#e6db74>&#39;klm&#39;</span>
    ],
    <span style=color:#a6e22e>temp</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>
  },
  <span style=color:#75715e>//事件处理函数
</span><span style=color:#75715e></span>  ...
  <span style=color:#a6e22e>changeStrs</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>){
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>index</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>currentTarget</span>.<span style=color:#a6e22e>id</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>strs</span>[<span style=color:#a6e22e>index</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>str</span>;
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>setData</span>({
       <span style=color:#a6e22e>strs</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>strs</span>
    });
  }
})

</code></pre></div><h2 id=heading-5>后台</h2><p>其实我也不会什么后台，PHP、NodeJs、Javaweb、Asp.net之流什么的也没玩过。只是因为最近"Py交易"多，所以才用了Python里的Flask框架。这里就没什么技术问题了。都是很简单的请求。这里贴上些简单的代码。</p><h3 id=heading-6>登录请求</h3><ol><li>登录</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>/api/gdut/login</span><span style=color:#e6db74>&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>GET</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>POST</span><span style=color:#e6db74>&#39;</span>])
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>login</span>():
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>POST</span><span style=color:#e6db74>&#39;</span>:                       
        <span style=color:#66d9ef>if</span> valid_login(request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>un</span><span style=color:#e6db74>&#39;</span>], request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>pd</span><span style=color:#e6db74>&#39;</span>]):
            <span style=color:#66d9ef>return</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>1</span><span style=color:#e6db74>&#39;</span>
        <span style=color:#66d9ef>else</span>:
            <span style=color:#66d9ef>return</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>0</span><span style=color:#e6db74>&#39;</span>
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>This is Login</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>s API page.~~~</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><ol start=2><li>获取登录者名字</li></ol><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>/api/gdut/name</span><span style=color:#e6db74>&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>GET</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>POST</span><span style=color:#e6db74>&#39;</span>])
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>name</span>():
    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>POST</span><span style=color:#e6db74>&#39;</span>:                          
        <span style=color:#66d9ef>if</span> lg<span style=color:#f92672>.</span>canLogin(request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>un</span><span style=color:#e6db74>&#39;</span>], request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>pd</span><span style=color:#e6db74>&#39;</span>]):
            <span style=color:#66d9ef>return</span> lg<span style=color:#f92672>.</span>getName(lg<span style=color:#f92672>.</span>getSession(request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>un</span><span style=color:#e6db74>&#39;</span>], request<span style=color:#f92672>.</span>form[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>pd</span><span style=color:#e6db74>&#39;</span>]))
        <span style=color:#66d9ef>else</span>:
            <span style=color:#66d9ef>return</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>0</span><span style=color:#e6db74>&#39;</span>
    <span style=color:#66d9ef>else</span>:
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>This is Name</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>s API page.~~~</span><span style=color:#e6db74>&#34;</span>
</code></pre></div><h2 id=heading-7>后言</h2><p>总的来说，这个东西并没有什么技术含量。但是经过这次对新教务系统的捉包与api测试，发现有太多吐槽点了。除了之前说的一点：后提交的数据可以覆盖之前提交的数据。大概有这么几点：</p><ul><li>教师评价中提交的内容不需要与系统提供的数据相符合
比如有这么个问题“授课过程是否充满热情”，有以下可以提交的内容：很热情、一般、不热情。但是你可以提交一个“十分激情”，甚至把题目提交成你想要的题目。</li><li>上面这些数据都是可以重复写入的</li><li>登录不触发验证码
本来这个系统是有验证码的，如果你在浏览器上（非隐身模式）登录教务系统，输入几次错误密码，验证码就出来了。但我每次使用的都是一个新的Session，所以没有触发验证码。</li></ul><h3 id=heading-8>时效</h3><p>学校正在把旧的教务系统上的内容逐步转移到新的教务系统。这期间API会不会变动就不知道了，毕竟做出这玩意来还是得维护的，若之后新教务系统上有了更多功能，这玩意也会更进一下。</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Rabbee</span></p><p class=copyright-item><span>Link:</span>
<a href=/2017/06/07/%E5%B9%BF%E5%B7%A5%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%8A%A9%E6%89%8B%E7%AC%94%E8%AE%B0/>/2017/06/07/%E5%B9%BF%E5%B7%A5%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%8A%A9%E6%89%8B%E7%AC%94%E8%AE%B0/</span></p><p class="copyright-item lincese">本文采用<a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<span class=tag><a href=tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/>#微信小程序</a></span>
<span class=tag><a href=tags/javascript/>#Javascript</a></span>
<span class=tag><a href=tags/python/>#Python</a></span></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href>home</a></span></section></div><div class=post-nav><a href=/2017/05/18/archlinux%E5%AE%89%E8%A3%85%E7%AC%94%E8%AE%B0/ class=prev rel=prev title=ArchLinux安装笔记><i class="iconfont icon-left"></i>&nbsp;ArchLinux安装笔记</a>
<a href=/2020/01/13/%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE/ class=next rel=next title=证书配置>证书配置&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=disqus_thread></div><script type=text/javascript>var d=document,s=d.createElement('script');s.src='//'+'rabbee'+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><div id=disqus_thread></div><script>(function(){var d=document,s=d.createElement('script');s.src='https://rabbee.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2020</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href>Rabbee</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></div></footer><link href=//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css rel=stylesheet><script src=/js/vendor_gallery.min.js async></script></div></body></html>